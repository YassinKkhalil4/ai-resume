"use strict";(()=>{var e={};e.id=647,e.ids=[647],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},39311:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>v,staticGenerationAsyncStorage:()=>k});var s={};r.r(s),r.d(s,{POST:()=>x,dynamic:()=>g,maxDuration:()=>h,runtime:()=>d});var n=r(49303),o=r(88716),i=r(60670),l=r(87070),a=r(32064),c=r(45647),u=r(85892),p=r(21614);let d="nodejs",g="force-dynamic",h=30;async function x(e){console.log("Process Experience API called:",{method:e.method,url:e.url,timestamp:new Date().toISOString()});try{let t,r;let s=(0,a.d7)(e);if(!s.ok)return s.res;let{experienceText:n,sessionId:o,jdText:i,tone:d="professional"}=await e.json();if(!n||!i)return l.NextResponse.json({code:"invalid_input",message:"Missing experience text or job description"},{status:400});console.log("Processing experience text:",{experienceTextLength:n.length,hasSessionId:!!o,jdTextLength:i.length,tone:d}),console.log("Extracting experience from free text...");let g=await (0,u._U)(n);if(0===g.length)return l.NextResponse.json({code:"no_experience_extracted",message:"Could not extract structured experience from the provided text"},{status:400});console.log("Extracted experience:",{experienceCount:g.length,totalBullets:g.reduce((e,t)=>e+t.bullets.length,0)});let h=null;o&&(h=(0,c.Gg)(o)),t=h?{...h.original,experience:g}:{summary:"Professional with relevant experience",skills:[],experience:g,education:[],certifications:[]},console.log("Created resume structure:",{hasSummary:!!t.summary,skillsCount:t.skills.length,experienceCount:t.experience.length,educationCount:t.education.length,certificationsCount:t.certifications.length});let x=(0,p.F)(t,i);console.log("ATS check completed:",{coverage:x.coverage,matchedKeywords:x.matched?.length||0,missingKeywords:x.missing?.length||0}),console.log("Starting AI tailoring...");let{tailored:f,tokens:m}=await (0,u.yC)(t,i,d);if(console.log("AI tailoring completed:",{hasSummary:!!f.summary,skillsCount:f.skills_section?.length||0,experienceCount:f.experience?.length||0,tokensUsed:m}),!(r=h?(0,c.CT)(o,{original:t,tailored:f,jdText:i,keywordStats:x}):(0,c.ed)(t,f,i,x)))return l.NextResponse.json({code:"session_error",message:"Failed to create or update session"},{status:500});return console.log("Experience processing completed successfully:",{sessionId:r.id,extractedExperienceCount:g.length}),l.NextResponse.json({success:!0,session_id:r.id,session_version:r.version,original_sections_json:t,preview_sections_json:f,keyword_stats:x,tokens_used:m,extracted_experience_count:g.length,message:"Experience processed and resume tailored successfully"})}catch(e){return console.error("Process experience error:",e),console.error("Error stack:",e instanceof Error?e.stack:"No stack trace"),l.NextResponse.json({code:"processing_failed",message:"Failed to process experience text",details:void 0,timestamp:new Date().toISOString()},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/process-experience/route",pathname:"/api/process-experience",filename:"route",bundlePath:"app/api/process-experience/route"},resolvedPagePath:"/Users/yassinkhalil/Downloads/ai-resume-tailor_v2_full/app/api/process-experience/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:k,serverHooks:v}=f,w="/api/process-experience/route";function y(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:k})}},21614:(e,t,r)=>{r.d(t,{F:()=>n});var s=r(58276);function n(e,t){let{all:r,must:n,nice:o}=(0,s.GI)(t,20),i=(function(e){let t=[];return e.summary&&t.push(e.summary),e.skills?.length&&t.push(e.skills.join(" ")),e.experience?.length&&e.experience.forEach(e=>{e.company&&t.push(e.company),e.role&&t.push(e.role),e.bullets?.length&&t.push(e.bullets.join(" "))}),e.education?.length&&t.push(e.education.join(" ")),e.certifications?.length&&t.push(e.certifications.join(" ")),t.join(" ")})(e).toLowerCase(),l=r.filter(e=>i.includes(e.toLowerCase())),a=r.filter(e=>!i.includes(e.toLowerCase())),c=n.filter(e=>i.includes(e.toLowerCase())),u=n.filter(e=>!i.includes(e.toLowerCase())),p=o.filter(e=>i.includes(e.toLowerCase())),d=o.filter(e=>!i.includes(e.toLowerCase())),g=[];return e.experience&&0!==e.experience.length&&e.experience.some(e=>e.company&&e.role&&(e.bullets?.length||0)>0)||g.push("No Experience section detected."),e.skills&&0!==e.skills.length&&e.skills.some(e=>e&&e.trim().length>2)||g.push("No Skills section detected."),{coverage:r.length?l.length/r.length:0,matched:l,missing:a,warnings:g,mustCoverage:n.length?c.length/n.length:0,niceCoverage:o.length?p.length/o.length:0,mustMatched:c,mustMissing:u,niceMatched:p,niceMissing:d,topMissing:a.slice(0,5)}}},32064:(e,t,r)=>{r.d(t,{d7:()=>p});var s=r(87070),n=r(74068);let o=new Map,i=new Map;function l(){return Date.now()}function a(e,t){let r=l();for(;e.length&&r-e[0]>t;)e.shift()}function c(e,t){let r=e.get(t)||[];return r.push(l()),e.set(t,r),r}function u(e,t){let r=(e.headers.get("cookie")||"").match(RegExp("(?:^|; )"+t+"=([^;]+)"));return r?decodeURIComponent(r[1]):null}function p(e){let t=(0,n.iE)();if(!function(e){let t=(0,n.iE)();if(!t.invites.length)return!0;let r=e.headers.get("x-invite-code")||"",s=u(e,"invite")||"",o=r||s;return!!o&&t.invites.includes(o)}(e))return{ok:!1,res:s.NextResponse.json({code:"invite_required",message:"Invite code required"},{status:403})};let r=(e.headers.get("x-forwarded-for")||"").split(",")[0].trim()||"0.0.0.0",p=u(e,"sid")||"anon",d=c(o,r),g=c(i,p);return(a(d,6e4),a(g,6e4),function(e=6e4,t=5e3){let r=l();for(let[t,s]of o){for(;s.length&&r-s[0]>e;)s.shift();0===s.length&&o.delete(t)}for(let[t,s]of i){for(;s.length&&r-s[0]>e;)s.shift();0===s.length&&i.delete(t)}if(o.size>t){for(let e of o.keys())if(o.delete(e),o.size<=t)break}if(i.size>t){for(let e of i.keys())if(i.delete(e),i.size<=t)break}}(),d.length>t.rate.ipPerMin||g.length>t.rate.sessionPerMin)?{ok:!1,res:s.NextResponse.json({code:"rate_limited",message:"Too many requests"},{status:429})}:{ok:!0}}},45647:(e,t,r)=>{r.d(t,{CT:()=>a,Gg:()=>l,ed:()=>i});var s=r(9576);let n=new Map;function o(e=36e5){let t=Date.now();for(let[r,s]of n)t-s.createdAt>e&&n.delete(r)}function i(e,t,r,i){o();let l=(0,s.Z)(),a={id:l,version:c(e,t),createdAt:Date.now(),original:e,tailored:t,jdText:r,keywordStats:i};return n.set(l,a),a}function l(e){o();let t=n.get(e);return t?Date.now()-t.createdAt>36e5?(n.delete(e),null):t:null}function a(e,t){let r=n.get(e);if(!r)return null;let s={...r,...t};return(t.original||t.tailored)&&(s.version=c(s.original,s.tailored)),n.set(e,s),s}function c(e,t){let r=JSON.stringify({original:e,tailored:t});return Buffer.from(r,"utf8").toString("base64").slice(0,16)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,214,882,440],()=>r(39311));module.exports=s})();