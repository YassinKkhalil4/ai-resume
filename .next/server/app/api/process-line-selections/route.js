"use strict";(()=>{var e={};e.id=516,e.ids=[516],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},38694:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>j,requestAsyncStorage:()=>y,routeModule:()=>v,serverHooks:()=>k,staticGenerationAsyncStorage:()=>b});var s={};r.r(s),r.d(s,{POST:()=>x,dynamic:()=>m,maxDuration:()=>f,runtime:()=>h});var n=r(49303),i=r(88716),o=r(60670),l=r(87070);function a(e){let t=e.trim();return/\b(19|20)\d{2}\b/.test(t)||/\b(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\b/i.test(t)||/\b(present|current|ongoing)\b/i.test(t)?"date":/^[A-Z][A-Z\s&.,-]+$/.test(t)&&(/\b(inc|llc|corp|ltd|company|co|group|technologies|systems|solutions|services)\b/i.test(t)||t.length>10)?"company":/^[A-Z][a-z\s&.,-]+$/.test(t)&&(/\b(engineer|developer|manager|director|analyst|specialist|coordinator|lead|senior|junior|architect|consultant|designer|programmer|administrator|supervisor|executive|officer|representative|assistant|intern|trainee)\b/i.test(t)||t.length>5&&t.length<50&&!t.includes("•")&&!t.includes("-"))?"role":/^[•\-\*]\s+/.test(t)||/^(developed|implemented|created|designed|managed|led|built|improved|increased|reduced|optimized|delivered|achieved|collaborated|coordinated|supervised|trained|mentored|analyzed|researched|planned|executed|maintained|supported|facilitated|organized|streamlined|enhanced|established|launched|initiated|oversaw|directed|guided|influenced|negotiated|presented|communicated|documented|tested|debugged|troubleshot|configured|deployed|integrated|customized|automated|scaled|monitored|evaluated|assessed|reviewed|audited|validated|verified|ensured|guaranteed|secured|protected|updated|upgraded|modernized|refactored)/i.test(t)?"bullet":"other"}function u(e){return{company:(e.company||"").trim()||"Unknown Company",role:(e.role||"").trim()||"Unknown Role",dates:(e.dates||"").trim()||"Dates not specified",bullets:(e.bullets||[]).map(e=>e.trim()).filter(e=>e.length>0).slice(0,12)}}var c=r(32064),d=r(45647),p=r(85892),g=r(21614);let h="nodejs",m="force-dynamic",f=30;async function x(e){console.log("Process Line Selections API called:",{method:e.method,url:e.url,timestamp:new Date().toISOString()});try{let t,r;let s=(0,c.d7)(e);if(!s.ok)return s.res;let{resumeText:n,selectedLines:i,sessionId:o,jdText:h,tone:m="professional"}=await e.json();if(!n||!i||!Array.isArray(i))return l.NextResponse.json({code:"invalid_input",message:"Missing or invalid resumeText or selectedLines"},{status:400});if(!h)return l.NextResponse.json({code:"missing_jd",message:"Job description text is required for tailoring"},{status:400});console.log("Processing line selections:",{resumeTextLength:n.length,selectedLinesCount:i.length,hasSessionId:!!o,jdTextLength:h.length,tone:m});let f=function(e,t){if(0===t.length)return[];let r={},s=[];t.forEach(e=>{e.groupId?(r[e.groupId]||(r[e.groupId]=[]),r[e.groupId].push(e)):s.push(e)});let n=[];if(Object.entries(r).forEach(([e,t])=>{let r=function(e){if(0===e.length)return null;let t=e.sort((e,t)=>e.lineIndex-t.lineIndex),r="",s="",n="",i=[];if(t.forEach(e=>{let t=e.lineText.trim();switch(e.type){case"company":r||(r=t);break;case"role":s||(s=t);break;case"date":n||(n=t);break;case"bullet":i.push(t);break;default:switch(a(t)){case"company":r||(r=t);break;case"role":s||(s=t);break;case"date":n||(n=t);break;default:i.push(t)}}}),!r&&!s){let e=t[0]?.lineText.trim()||"";if(e){let t=e.split(" - ");t.length>=2?(r=t[0].trim(),s=t[1].trim()):(r=e,s="Various Roles")}}return r||(r="Unknown Company"),s||(s="Various Roles"),n||(n="Dates not specified"),{company:r,role:s,dates:n,bullets:i.length>0?i:["Experience details not specified"]}}(t);r&&n.push(r)}),s.length>0){let e=function(e){if(0===e.length)return null;let t=e.sort((e,t)=>e.lineIndex-t.lineIndex).map(e=>e.lineText.trim()).filter(Boolean);if(0===t.length)return null;let r="",s="",n="",i=[];for(let e=0;e<Math.min(3,t.length);e++){let i=t[e],o=a(i);"company"!==o||r?"role"!==o||s?"date"!==o||n||(n=i):s=i:r=i}if(!r&&!s&&t.length>0){let e=t[0],n=e.split(" - ");n.length>=2?(r=n[0].trim(),s=n[1].trim()):(r=e,s="Various Roles")}return t.forEach((e,t)=>{!(t>=3)&&r&&s||i.push(e)}),r||(r="Various Companies"),s||(s="Various Roles"),n||(n="Dates not specified"),{company:r,role:s,dates:n,bullets:i.length>0?i:["Experience details not specified"]}}(s);e&&n.push(e)}return n}(0,i);if(0===f.length)return l.NextResponse.json({code:"no_experience_processed",message:"No valid experience could be extracted from the selected lines"},{status:400});let x=f.map(u),v=null;o&&(v=(0,d.Gg)(o)),t=v?{...v.original,experience:x}:{summary:"Professional with relevant experience",skills:[],experience:x,education:[],certifications:[]},console.log("Created resume structure:",{hasSummary:!!t.summary,skillsCount:t.skills.length,experienceCount:t.experience.length,educationCount:t.education.length,certificationsCount:t.certifications.length});let y=(0,g.F)(t,h);console.log("ATS check completed:",{coverage:y.coverage,matchedKeywords:y.matched?.length||0,missingKeywords:y.missing?.length||0}),console.log("Starting AI tailoring...");let{tailored:b,tokens:k}=await (0,p.yC)(t,h,m);if(console.log("AI tailoring completed:",{hasSummary:!!b.summary,skillsCount:b.skills_section?.length||0,experienceCount:b.experience?.length||0,tokensUsed:k}),!(r=v?(0,d.CT)(o,{original:t,tailored:b,jdText:h,keywordStats:y}):(0,d.ed)(t,b,h,y)))return l.NextResponse.json({code:"session_error",message:"Failed to create or update session"},{status:500});let w=function(e,t){let r=new Set(e.map(e=>e.groupId).filter(Boolean));return{totalLines:e.length,totalExperiences:t.length,totalBullets:t.reduce((e,t)=>e+t.bullets.length,0),groups:r.size,ungrouped:e.filter(e=>!e.groupId).length}}(i,x);return console.log("Line selection processing completed successfully:",{sessionId:r.id,summary:w}),l.NextResponse.json({success:!0,session_id:r.id,session_version:r.version,original_sections_json:t,preview_sections_json:b,keyword_stats:y,tokens_used:k,processing_summary:w,message:"Line selections processed and resume tailored successfully"})}catch(e){return console.error("Process line selections error:",e),console.error("Error stack:",e instanceof Error?e.stack:"No stack trace"),l.NextResponse.json({code:"processing_failed",message:"Failed to process line selections",details:void 0,timestamp:new Date().toISOString()},{status:500})}}let v=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/process-line-selections/route",pathname:"/api/process-line-selections",filename:"route",bundlePath:"app/api/process-line-selections/route"},resolvedPagePath:"/Users/yassinkhalil/Downloads/ai-resume-tailor_v2_full/app/api/process-line-selections/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:b,serverHooks:k}=v,w="/api/process-line-selections/route";function j(){return(0,o.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:b})}},21614:(e,t,r)=>{r.d(t,{F:()=>n});var s=r(58276);function n(e,t){let{all:r,must:n,nice:i}=(0,s.GI)(t,20),o=(function(e){let t=[];return e.summary&&t.push(e.summary),e.skills?.length&&t.push(e.skills.join(" ")),e.experience?.length&&e.experience.forEach(e=>{e.company&&t.push(e.company),e.role&&t.push(e.role),e.bullets?.length&&t.push(e.bullets.join(" "))}),e.education?.length&&t.push(e.education.join(" ")),e.certifications?.length&&t.push(e.certifications.join(" ")),t.join(" ")})(e).toLowerCase(),l=r.filter(e=>o.includes(e.toLowerCase())),a=r.filter(e=>!o.includes(e.toLowerCase())),u=n.filter(e=>o.includes(e.toLowerCase())),c=n.filter(e=>!o.includes(e.toLowerCase())),d=i.filter(e=>o.includes(e.toLowerCase())),p=i.filter(e=>!o.includes(e.toLowerCase())),g=[];return e.experience&&0!==e.experience.length&&e.experience.some(e=>e.company&&e.role&&(e.bullets?.length||0)>0)||g.push("No Experience section detected."),e.skills&&0!==e.skills.length&&e.skills.some(e=>e&&e.trim().length>2)||g.push("No Skills section detected."),{coverage:r.length?l.length/r.length:0,matched:l,missing:a,warnings:g,mustCoverage:n.length?u.length/n.length:0,niceCoverage:i.length?d.length/i.length:0,mustMatched:u,mustMissing:c,niceMatched:d,niceMissing:p,topMissing:a.slice(0,5)}}},32064:(e,t,r)=>{r.d(t,{d7:()=>d});var s=r(87070),n=r(74068);let i=new Map,o=new Map;function l(){return Date.now()}function a(e,t){let r=l();for(;e.length&&r-e[0]>t;)e.shift()}function u(e,t){let r=e.get(t)||[];return r.push(l()),e.set(t,r),r}function c(e,t){let r=(e.headers.get("cookie")||"").match(RegExp("(?:^|; )"+t+"=([^;]+)"));return r?decodeURIComponent(r[1]):null}function d(e){let t=(0,n.iE)();if(!function(e){let t=(0,n.iE)();if(!t.invites.length)return!0;let r=e.headers.get("x-invite-code")||"",s=c(e,"invite")||"",i=r||s;return!!i&&t.invites.includes(i)}(e))return{ok:!1,res:s.NextResponse.json({code:"invite_required",message:"Invite code required"},{status:403})};let r=(e.headers.get("x-forwarded-for")||"").split(",")[0].trim()||"0.0.0.0",d=c(e,"sid")||"anon",p=u(i,r),g=u(o,d);return(a(p,6e4),a(g,6e4),function(e=6e4,t=5e3){let r=l();for(let[t,s]of i){for(;s.length&&r-s[0]>e;)s.shift();0===s.length&&i.delete(t)}for(let[t,s]of o){for(;s.length&&r-s[0]>e;)s.shift();0===s.length&&o.delete(t)}if(i.size>t){for(let e of i.keys())if(i.delete(e),i.size<=t)break}if(o.size>t){for(let e of o.keys())if(o.delete(e),o.size<=t)break}}(),p.length>t.rate.ipPerMin||g.length>t.rate.sessionPerMin)?{ok:!1,res:s.NextResponse.json({code:"rate_limited",message:"Too many requests"},{status:429})}:{ok:!0}}},45647:(e,t,r)=>{r.d(t,{CT:()=>a,Gg:()=>l,ed:()=>o});var s=r(9576);let n=new Map;function i(e=36e5){let t=Date.now();for(let[r,s]of n)t-s.createdAt>e&&n.delete(r)}function o(e,t,r,o){i();let l=(0,s.Z)(),a={id:l,version:u(e,t),createdAt:Date.now(),original:e,tailored:t,jdText:r,keywordStats:o};return n.set(l,a),a}function l(e){i();let t=n.get(e);return t?Date.now()-t.createdAt>36e5?(n.delete(e),null):t:null}function a(e,t){let r=n.get(e);if(!r)return null;let s={...r,...t};return(t.original||t.tailored)&&(s.version=u(s.original,s.tailored)),n.set(e,s),s}function u(e,t){let r=JSON.stringify({original:e,tailored:t});return Buffer.from(r,"utf8").toString("base64").slice(0,16)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,214,882,440],()=>r(38694));module.exports=s})();