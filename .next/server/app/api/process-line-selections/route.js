"use strict";(()=>{var e={};e.id=516,e.ids=[516],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},38694:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>w,patchFetch:()=>j,requestAsyncStorage:()=>b,routeModule:()=>y,serverHooks:()=>k,staticGenerationAsyncStorage:()=>v});var r={};s.r(r),s.d(r,{POST:()=>x,dynamic:()=>h,maxDuration:()=>f,runtime:()=>g});var n=s(49303),i=s(88716),o=s(60670),l=s(87070);function a(e){let t=e.trim();return/\b(19|20)\d{2}\b/.test(t)||/\b(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\b/i.test(t)||/\b(present|current|ongoing)\b/i.test(t)?"date":/^[A-Z][A-Z\s&.,-]+$/.test(t)&&(/\b(inc|llc|corp|ltd|company|co|group|technologies|systems|solutions|services)\b/i.test(t)||t.length>10)?"company":/^[A-Z][a-z\s&.,-]+$/.test(t)&&(/\b(engineer|developer|manager|director|analyst|specialist|coordinator|lead|senior|junior|architect|consultant|designer|programmer|administrator|supervisor|executive|officer|representative|assistant|intern|trainee)\b/i.test(t)||t.length>5&&t.length<50&&!t.includes("•")&&!t.includes("-"))?"role":/^[•\-\*]\s+/.test(t)||/^(developed|implemented|created|designed|managed|led|built|improved|increased|reduced|optimized|delivered|achieved|collaborated|coordinated|supervised|trained|mentored|analyzed|researched|planned|executed|maintained|supported|facilitated|organized|streamlined|enhanced|established|launched|initiated|oversaw|directed|guided|influenced|negotiated|presented|communicated|documented|tested|debugged|troubleshot|configured|deployed|integrated|customized|automated|scaled|monitored|evaluated|assessed|reviewed|audited|validated|verified|ensured|guaranteed|secured|protected|updated|upgraded|modernized|refactored)/i.test(t)?"bullet":"other"}function d(e){return{company:e.company.trim()||"Unknown Company",role:e.role.trim()||"Unknown Role",dates:e.dates.trim()||"Dates not specified",bullets:e.bullets.map(e=>e.trim()).filter(e=>e.length>0).slice(0,12)}}var c=s(32064),u=s(45647),p=s(69836),m=s(21614);let g="nodejs",h="force-dynamic",f=30;async function x(e){console.log("Process Line Selections API called:",{method:e.method,url:e.url,timestamp:new Date().toISOString()});try{let t,s;let r=(0,c.d7)(e);if(!r.ok)return r.res;let{resumeText:n,selectedLines:i,sessionId:o,jdText:g,tone:h="professional"}=await e.json();if(!n||!i||!Array.isArray(i))return l.NextResponse.json({code:"invalid_input",message:"Missing or invalid resumeText or selectedLines"},{status:400});if(!g)return l.NextResponse.json({code:"missing_jd",message:"Job description text is required for tailoring"},{status:400});console.log("Processing line selections:",{resumeTextLength:n.length,selectedLinesCount:i.length,hasSessionId:!!o,jdTextLength:g.length,tone:h});let f=function(e,t){if(0===t.length)return[];let s={},r=[];t.forEach(e=>{e.groupId?(s[e.groupId]||(s[e.groupId]=[]),s[e.groupId].push(e)):r.push(e)});let n=[];if(Object.entries(s).forEach(([e,t])=>{let s=function(e){if(0===e.length)return null;let t=e.sort((e,t)=>e.lineIndex-t.lineIndex),s="",r="",n="",i=[];if(t.forEach(e=>{let t=e.lineText.trim();switch(e.type){case"company":s||(s=t);break;case"role":r||(r=t);break;case"date":n||(n=t);break;case"bullet":i.push(t);break;default:switch(a(t)){case"company":s||(s=t);break;case"role":r||(r=t);break;case"date":n||(n=t);break;default:i.push(t)}}}),!s&&!r){let e=t[0]?.lineText.trim()||"";if(e){let t=e.split(" - ");t.length>=2?(s=t[0].trim(),r=t[1].trim()):(s=e,r="Various Roles")}}return s||(s="Unknown Company"),r||(r="Various Roles"),n||(n="Dates not specified"),{company:s,role:r,dates:n,bullets:i.length>0?i:["Experience details not specified"]}}(t);s&&n.push(s)}),r.length>0){let e=function(e){if(0===e.length)return null;let t=e.sort((e,t)=>e.lineIndex-t.lineIndex).map(e=>e.lineText.trim()).filter(Boolean);if(0===t.length)return null;let s="",r="",n="",i=[];for(let e=0;e<Math.min(3,t.length);e++){let i=t[e],o=a(i);"company"!==o||s?"role"!==o||r?"date"!==o||n||(n=i):r=i:s=i}if(!s&&!r&&t.length>0){let e=t[0],n=e.split(" - ");n.length>=2?(s=n[0].trim(),r=n[1].trim()):(s=e,r="Various Roles")}return t.forEach((e,t)=>{!(t>=3)&&s&&r||i.push(e)}),s||(s="Various Companies"),r||(r="Various Roles"),n||(n="Dates not specified"),{company:s,role:r,dates:n,bullets:i.length>0?i:["Experience details not specified"]}}(r);e&&n.push(e)}return n}(0,i);if(0===f.length)return l.NextResponse.json({code:"no_experience_processed",message:"No valid experience could be extracted from the selected lines"},{status:400});let x=f.map(d),y=null;o&&(y=(0,u.Gg)(o)),t=y?{...y.original,experience:x}:{summary:"Professional with relevant experience",skills:[],experience:x,education:[],certifications:[]},console.log("Created resume structure:",{hasSummary:!!t.summary,skillsCount:t.skills.length,experienceCount:t.experience.length,educationCount:t.education.length,certificationsCount:t.certifications.length});let b=(0,m.F)(t,g);console.log("ATS check completed:",{coverage:b.coverage,matchedKeywords:b.matched?.length||0,missingKeywords:b.missing?.length||0}),console.log("Starting AI tailoring...");let{tailored:v,tokens:k}=await (0,p.yC)(t,g,h);if(console.log("AI tailoring completed:",{hasSummary:!!v.summary,skillsCount:v.skills_section?.length||0,experienceCount:v.experience?.length||0,tokensUsed:k}),!(s=y?(0,u.CT)(o,{original:t,tailored:v,jdText:g,keywordStats:b}):(0,u.ed)(t,v,g,b)))return l.NextResponse.json({code:"session_error",message:"Failed to create or update session"},{status:500});let w=function(e,t){let s=new Set(e.map(e=>e.groupId).filter(Boolean));return{totalLines:e.length,totalExperiences:t.length,totalBullets:t.reduce((e,t)=>e+t.bullets.length,0),groups:s.size,ungrouped:e.filter(e=>!e.groupId).length}}(i,x);return console.log("Line selection processing completed successfully:",{sessionId:s.id,summary:w}),l.NextResponse.json({success:!0,session_id:s.id,session_version:s.version,original_sections_json:t,preview_sections_json:v,keyword_stats:b,tokens_used:k,processing_summary:w,message:"Line selections processed and resume tailored successfully"})}catch(e){return console.error("Process line selections error:",e),console.error("Error stack:",e instanceof Error?e.stack:"No stack trace"),l.NextResponse.json({code:"processing_failed",message:"Failed to process line selections",details:void 0,timestamp:new Date().toISOString()},{status:500})}}let y=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/process-line-selections/route",pathname:"/api/process-line-selections",filename:"route",bundlePath:"app/api/process-line-selections/route"},resolvedPagePath:"/Users/yassinkhalil/Downloads/ai-resume-tailor_v2_full/app/api/process-line-selections/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:b,staticGenerationAsyncStorage:v,serverHooks:k}=y,w="/api/process-line-selections/route";function j(){return(0,o.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:v})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,972,844,542],()=>s(38694));module.exports=r})();