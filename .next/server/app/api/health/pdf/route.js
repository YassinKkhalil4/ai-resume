"use strict";(()=>{var e={};e.id=892,e.ids=[892],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},30:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>p,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{GET:()=>l});var i=s(49303),o=s(88716),n=s(60670),a=s(87070),c=s(37188);async function l(e){try{let e=await (0,c.lN)(),t=(0,c.XB)();return a.NextResponse.json({service:"pdf-generation",status:e.status,issues:e.issues,metrics:{totalRequests:t.totalRequests,successRate:`${t.successRate.toFixed(1)}%`,averageResponseTime:`${t.averageResponseTime.toFixed(0)}ms`,methodBreakdown:t.methodBreakdown,qualityBreakdown:t.qualityBreakdown,errorBreakdown:t.errorBreakdown},timestamp:e.timestamp,uptime:process.uptime()})}catch(e){return a.NextResponse.json({service:"pdf-generation",status:"error",error:e instanceof Error?e.message:"Unknown error",timestamp:new Date().toISOString()},{status:500})}}let u=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/health/pdf/route",pathname:"/api/health/pdf",filename:"route",bundlePath:"app/api/health/pdf/route"},resolvedPagePath:"/Users/yassinkhalil/Downloads/ai-resume-tailor_v2_full/app/api/health/pdf/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:h}=u,p="/api/health/pdf/route";function y(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},37188:(e,t,s)=>{s.d(t,{XB:()=>a,lN:()=>n});var r=s(57033);class i{async trackPDFRequest(e,t,s,r,i){this.metrics.totalRequests++,t?this.metrics.successfulRequests++:this.metrics.failedRequests++,this.metrics.successRate=this.metrics.successfulRequests/this.metrics.totalRequests*100,this.metrics.averageResponseTime=(this.metrics.averageResponseTime*(this.metrics.totalRequests-1)+s)/this.metrics.totalRequests,this.metrics.methodBreakdown[e]||(this.metrics.methodBreakdown[e]={count:0,successRate:0}),this.metrics.methodBreakdown[e].count++,this.metrics.methodBreakdown[e].successRate=(this.metrics.methodBreakdown[e].count*this.metrics.methodBreakdown[e].successRate+(t?1:0))/this.metrics.methodBreakdown[e].count,i&&(this.metrics.qualityBreakdown[i]=(this.metrics.qualityBreakdown[i]||0)+1),r&&(this.metrics.errorBreakdown[r]=(this.metrics.errorBreakdown[r]||0)+1),t||await this.checkAlertConditions(e,r||"Unknown error")}async checkAlertConditions(e,t){let s=Date.now(),r=this.metrics.failedRequests,i="low";r>=this.failureThresholds.critical?i="critical":r>=this.failureThresholds.high?i="high":r>=this.failureThresholds.medium&&(i="medium");let o=`${e}-${i}`;s-(this.alertCooldowns.get(o)||0)<("critical"===i?6e4:3e5)||(await this.sendAlert({timestamp:new Date().toISOString(),sessionId:"system",method:e,error:t,htmlLength:0,retryCount:0,fallbackUsed:!1,severity:i}),this.alertCooldowns.set(o,s))}async sendAlert(e){if(console.error(`ðŸš¨ PDF ALERT [${e.severity.toUpperCase()}]:`,{method:e.method,error:e.error,severity:e.severity,timestamp:e.timestamp}),(0,r.H)(Error(`PDF Alert: ${e.error}`),{alert:e,severity:e.severity,method:e.method}),process.env.MONITORING_WEBHOOK_URL)try{await fetch(process.env.MONITORING_WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:`ðŸš¨ PDF Generation Alert [${e.severity.toUpperCase()}]`,attachments:[{color:"critical"===e.severity?"danger":"high"===e.severity?"warning":"good",fields:[{title:"Method",value:e.method,short:!0},{title:"Error",value:e.error,short:!1},{title:"Severity",value:e.severity,short:!0},{title:"Time",value:e.timestamp,short:!0}]}]})})}catch(e){console.error("Failed to send monitoring webhook:",e)}"critical"===e.severity&&process.env.ALERT_EMAIL&&await this.sendEmailAlert(e)}async sendEmailAlert(e){console.error(`ðŸ“§ CRITICAL PDF FAILURE - Email alert would be sent to ${process.env.ALERT_EMAIL}`)}getMetrics(){return{...this.metrics}}resetMetrics(){this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,successRate:0,averageResponseTime:0,methodBreakdown:{},qualityBreakdown:{},errorBreakdown:{}}}getHealthStatus(){let e=this.metrics.successRate,t=this.metrics.averageResponseTime,s="healthy",r=[];return e<80?(s="unhealthy",r.push(`Low success rate: ${e.toFixed(1)}%`)):e<95&&(s="degraded",r.push(`Degraded success rate: ${e.toFixed(1)}%`)),t>1e4&&(s="healthy"===s?"degraded":s,r.push(`Slow response time: ${t.toFixed(0)}ms`)),{status:s,issues:r,metrics:this.metrics,timestamp:new Date().toISOString()}}constructor(){this.failureThresholds={low:5,medium:10,high:20,critical:50},this.alertCooldowns=new Map,this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,successRate:0,averageResponseTime:0,methodBreakdown:{},qualityBreakdown:{},errorBreakdown:{}}}}let o=new i;async function n(){return o.getHealthStatus()}function a(){return o.getMetrics()}},57033:(e,t,s)=>{s.d(t,{H:()=>d,Jf:()=>h,Ud:()=>u,db:()=>l,zJ:()=>m});var r=s(57147),i=s.n(r),o=s(9576);let n="/tmp/telemetry.jsonl",a=process.env.LOG_DRAIN_URL||"",c=process.env.LOG_DRAIN_KEY||"";function l(e={}){let t=(0,o.Z)(),s=Date.now();return{id:t,end:function(r,o={}){let a={req_id:t,route:e.route||"unknown",timing:Date.now()-s,timestamp:new Date().toISOString(),final_status:r?"success":"error",...e,...o};try{i().appendFileSync(n,JSON.stringify(a)+"\n")}catch(e){console.warn("Failed to write telemetry:",e)}return p(a),a}}}function u(e,t,s,r,o){let n={timestamp:new Date().toISOString(),type:"ai_response",attempt:e,success:t,error:s?.substring(0,500),responseLength:r,model:o||process.env.OPENAI_MODEL||"gpt-4o-mini"};try{i().appendFileSync("/tmp/ai-responses.jsonl",JSON.stringify(n)+"\n")}catch(e){console.warn("Failed to log AI response:",e)}p(n)}function d(e,t={}){let s={timestamp:new Date().toISOString(),type:"error",message:e.message,stack:e.stack,context:JSON.stringify(t)};try{i().appendFileSync("/tmp/error-log.jsonl",JSON.stringify(s)+"\n")}catch(e){console.warn("Failed to log error:",e)}p(s)}function m(e,t,s,r,o){let a={timestamp:new Date().toISOString(),type:"pdf_generation",attempt:e,success:t,error:s?.substring(0,500),method:r,size:o};try{i().appendFileSync(n,JSON.stringify(a)+"\n")}catch(e){console.warn("Failed to log PDF generation:",e)}p(a)}function h(e){let t={timestamp:new Date().toISOString(),type:"request_telemetry",...e};try{i().appendFileSync(n,JSON.stringify(t)+"\n")}catch(e){console.warn("Failed to log request telemetry:",e)}p(t)}async function p(e){if(a)try{await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",...c?{Authorization:`Bearer ${c}`}:{}},body:JSON.stringify(e)})}catch{}}},9576:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(6113),i=s.n(r);let o={randomUUID:i().randomUUID},n=new Uint8Array(256),a=n.length,c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));let l=function(e,t,s){if(o.randomUUID&&!t&&!e)return o.randomUUID();let r=(e=e||{}).random||(e.rng||function(){return a>n.length-16&&(i().randomFillSync(n),a=0),n.slice(a,a+=16)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){s=s||0;for(let e=0;e<16;++e)t[s+e]=r[e];return t}return function(e,t=0){return c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]}(r)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,972],()=>s(30));module.exports=r})();