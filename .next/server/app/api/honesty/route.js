"use strict";(()=>{var e={};e.id=306,e.ids=[306],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},78160:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>v,patchFetch:()=>x,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var r={};n.r(r),n.d(r,{POST:()=>p,dynamic:()=>d,runtime:()=>f});var s=n(49303),o=n(88716),i=n(60670),a=n(87070),l=n(45647);function u(e){return new Set((e.toLowerCase().match(/[a-z0-9\-\+\.]{3,}/g)||[]).filter(e=>!["and","the","for","with","from","this","that"].includes(e)))}var c=n(32064);let d="force-dynamic",f="nodejs";async function p(e){try{if(!process.env.OPENAI_API_KEY)return a.NextResponse.json({code:"no_openai_key",message:"Server not configured"},{status:503});let t=(0,c.d7)(e);if(!t.ok)return t.res;let{session_id:n,original_experience:r,tailored_experience:s,session_version:o,original_payload:i,tailored_payload:d}=await e.json()||{};if(!n)return a.NextResponse.json({code:"missing_session_id",message:"Session ID required"},{status:400});let f=r,p=s;if(i&&d)f=i.experience||[],p=d.experience||[],console.log("Using direct payloads for honesty scan");else{let e=(0,l.Gg)(n);e&&e.original&&e.tailored&&(f=e.original.experience||[],p=e.tailored.experience||[],console.log("Using session data for honesty scan"))}if(!f||!p)return a.NextResponse.json({code:"missing_data",message:"Original or tailored experience data required. Please ensure the resume has been processed first.",suggestion:"Try refreshing the page and running the honesty scan again.",session_version:o||"unknown"},{status:400});if(o){let e=(0,l.Gg)(n);if(e&&e.version!==o)return a.NextResponse.json({code:"stale_session",message:"Session data is outdated. Please refresh the page and try again.",session_version:e.version,provided_version:o},{status:409})}let g=function(e,t){let n=[],r=new Map;for(let t of e)r.set(t.company+"|"+t.role,t);for(let e of t){let t=e.company+"|"+e.role,s=r.get(t);if(s)for(let t of e.bullets){let r=u(t),o=0,i=[];for(let e of s.bullets){let t=function(e,t){let n=new Set([...e].filter(e=>t.has(e))),r=new Set([...e,...t]);return r.size?n.size/r.size:0}(r,u(e));t>o&&(o=t,i=[e])}(o<.15||0===o&&t.length>20)&&n.push({role:`${e.role} @ ${e.company}`,bullet:t,score:Number(o.toFixed(2)),backing:i})}}return{flags:n}}(f,p);return a.NextResponse.json({...g,session_version:o||"unknown"})}catch(e){return console.error("Honesty scan error:",e),a.NextResponse.json({code:"honesty_scan_failed",message:"Honesty scan failed. Please try again.",details:void 0},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/honesty/route",pathname:"/api/honesty",filename:"route",bundlePath:"app/api/honesty/route"},resolvedPagePath:"/Users/yassinkhalil/Downloads/ai-resume-tailor_v2_full/app/api/honesty/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:y}=g,v="/api/honesty/route";function x(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},74068:(e,t,n)=>{n.d(t,{iE:()=>a,rF:()=>l});var r=n(57147),s=n.n(r);let o="/tmp/ai-resume-tailor-config.json",i={rate:{ipPerMin:Number(process.env.RATE_IP_PER_MIN||30),sessionPerMin:Number(process.env.RATE_SESSION_PER_MIN||5)},invites:(process.env.INVITE_CODES||"").split(",").map(e=>e.trim()).filter(Boolean),openaiKey:void 0,pauseTailor:!1,pauseExport:!1};function a(){return i}function l(e){i={...i,...e,rate:{...i.rate,...e.rate||{}}},function(){try{s().writeFileSync(o,JSON.stringify(i,null,2))}catch{}}()}!function(){try{if(s().existsSync(o)){let e=s().readFileSync(o,"utf8"),t=JSON.parse(e);i={...i,...t}}}catch{}}()},32064:(e,t,n)=>{n.d(t,{d7:()=>d});var r=n(87070),s=n(74068);let o=new Map,i=new Map;function a(){return Date.now()}function l(e,t){let n=a();for(;e.length&&n-e[0]>t;)e.shift()}function u(e,t){let n=e.get(t)||[];return n.push(a()),e.set(t,n),n}function c(e,t){let n=(e.headers.get("cookie")||"").match(RegExp("(?:^|; )"+t+"=([^;]+)"));return n?decodeURIComponent(n[1]):null}function d(e){let t=(0,s.iE)();if(!function(e){let t=(0,s.iE)();if(!t.invites.length)return!0;let n=e.headers.get("x-invite-code")||"",r=c(e,"invite")||"",o=n||r;return!!o&&t.invites.includes(o)}(e))return{ok:!1,res:r.NextResponse.json({code:"invite_required",message:"Invite code required"},{status:403})};let n=(e.headers.get("x-forwarded-for")||"").split(",")[0].trim()||"0.0.0.0",d=c(e,"sid")||"anon",f=u(o,n),p=u(i,d);return(l(f,6e4),l(p,6e4),function(e=6e4,t=5e3){let n=a();for(let[t,r]of o){for(;r.length&&n-r[0]>e;)r.shift();0===r.length&&o.delete(t)}for(let[t,r]of i){for(;r.length&&n-r[0]>e;)r.shift();0===r.length&&i.delete(t)}if(o.size>t){for(let e of o.keys())if(o.delete(e),o.size<=t)break}if(i.size>t){for(let e of i.keys())if(i.delete(e),i.size<=t)break}}(),f.length>t.rate.ipPerMin||p.length>t.rate.sessionPerMin)?{ok:!1,res:r.NextResponse.json({code:"rate_limited",message:"Too many requests"},{status:429})}:{ok:!0}}},45647:(e,t,n)=>{n.d(t,{CT:()=>l,Gg:()=>a,ed:()=>i});var r=n(9576);let s=new Map;function o(e=36e5){let t=Date.now();for(let[n,r]of s)t-r.createdAt>e&&s.delete(n)}function i(e,t,n,i){o();let a=(0,r.Z)(),l={id:a,version:u(e,t),createdAt:Date.now(),original:e,tailored:t,jdText:n,keywordStats:i};return s.set(a,l),l}function a(e){o();let t=s.get(e);return t?Date.now()-t.createdAt>36e5?(s.delete(e),null):t:null}function l(e,t){let n=s.get(e);if(!n)return null;let r={...n,...t};return(t.original||t.tailored)&&(r.version=u(r.original,r.tailored)),s.set(e,r),r}function u(e,t){return btoa(JSON.stringify({original:e,tailored:t})).slice(0,16)}},9576:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(6113),s=n.n(r);let o={randomUUID:s().randomUUID},i=new Uint8Array(256),a=i.length,l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));let u=function(e,t,n){if(o.randomUUID&&!t&&!e)return o.randomUUID();let r=(e=e||{}).random||(e.rng||function(){return a>i.length-16&&(s().randomFillSync(i),a=0),i.slice(a,a+=16)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]}(r)}}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[948,972],()=>n(78160));module.exports=r})();