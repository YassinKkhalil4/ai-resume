"use strict";(()=>{var e={};e.id=843,e.ids=[843],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},87574:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>y,patchFetch:()=>x,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>v});var r={};n.r(r),n.d(r,{POST:()=>g,dynamic:()=>c,runtime:()=>p});var i=n(49303),o=n(88716),s=n(60670),a=n(87070),l=n(45647);function u(e){return new Set(e.toLowerCase().match(/[a-z0-9\+#\.\-]{3,}/g)||[])}function f(e){return e.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>2).filter(e=>!["the","and","or","but","in","on","at","to","for","of","with","by"].includes(e))}var d=n(32064);let c="force-dynamic",p="nodejs";async function g(e){try{let t=(0,d.d7)(e);if(!t.ok)return t.res;let{session_id:n,original_experience:r,tailored_experience:i,session_version:o,original_payload:s,tailored_payload:c}=await e.json()||{};if(!n)return a.NextResponse.json({code:"missing_session_id",message:"Session ID required"},{status:400});let p=r,g=i;if(s&&c)p=s.experience||[],g=c.experience||[],console.log("Using direct payloads for diff generation");else{let e=(0,l.Gg)(n);e&&e.original&&e.tailored&&(p=e.original.experience||[],g=e.tailored.experience||[],console.log("Using session data for diff generation"))}if(!p||!g)return a.NextResponse.json({code:"missing_data",message:"Original or tailored experience data required for diff generation.",suggestion:"Try refreshing the page and try again.",session_version:o||"unknown"},{status:400});if(o){let e=(0,l.Gg)(n);if(e&&e.version!==o)return a.NextResponse.json({code:"stale_session",message:"Session data is outdated. Please refresh the page and try again.",session_version:e.version,provided_version:o},{status:409})}let m=function(e,t){let n=[],r=new Map;for(let t of e){let e=`${t.company}|${t.role}`.toLowerCase().trim();r.set(e,t)}for(let e of t){let t=`${e.company}|${e.role}`.toLowerCase().trim(),i=r.get(t);if(!i){n.push({role:`${e.role} @ ${e.company}`,original:[],tailored:e.bullets||[],reasons:["New role added"]});continue}let o=i.bullets||[],s=e.bullets||[];if(function(e,t){if(e.length!==t.length)return!0;for(let n=0;n<e.length;n++){let r=e[n]||"",i=t[n]||"",o=f(r);if(.8>function(e,t){let n=new Set(e),r=new Set(t),i=new Set([...n].filter(e=>r.has(e))),o=new Set([...n,...r]);return o.size>0?i.size/o.size:0}(o,f(i)))return!0}return!1}(o,s)){let t=function(e,t){let n=new Set,r=new Set;for(let t of e)for(let e of u(t))n.add(e);for(let e of t)for(let t of u(e))r.add(t);let i=[...r].filter(e=>!n.has(e)).slice(0,8);return i.length?i.map(e=>`Emphasized "${e}" based on JD alignment.`):[]}(o,s);n.push({role:`${e.role} @ ${e.company}`,original:o,tailored:s,reasons:t})}}return n}(p,g);return a.NextResponse.json({diffs:m,session_version:o||"unknown"})}catch(e){return console.error("Diff generation error:",e),a.NextResponse.json({code:"diff_generation_failed",message:"Failed to generate diffs. Please try again.",details:void 0},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/diff/route",pathname:"/api/diff",filename:"route",bundlePath:"app/api/diff/route"},resolvedPagePath:"/Users/yassinkhalil/Downloads/ai-resume-tailor_v2_full/app/api/diff/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:v,serverHooks:w}=m,y="/api/diff/route";function x(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:v})}},74068:(e,t,n)=>{n.d(t,{iE:()=>a,rF:()=>l});var r=n(57147),i=n.n(r);let o="/tmp/ai-resume-tailor-config.json",s={rate:{ipPerMin:Number(process.env.RATE_IP_PER_MIN||30),sessionPerMin:Number(process.env.RATE_SESSION_PER_MIN||5)},invites:(process.env.INVITE_CODES||"").split(",").map(e=>e.trim()).filter(Boolean),openaiKey:void 0,pauseTailor:!1,pauseExport:!1};function a(){return s}function l(e){s={...s,...e,rate:{...s.rate,...e.rate||{}}},function(){try{i().writeFileSync(o,JSON.stringify(s,null,2))}catch{}}()}!function(){try{if(i().existsSync(o)){let e=i().readFileSync(o,"utf8"),t=JSON.parse(e);s={...s,...t}}}catch{}}()},32064:(e,t,n)=>{n.d(t,{d7:()=>d});var r=n(87070),i=n(74068);let o=new Map,s=new Map;function a(){return Date.now()}function l(e,t){let n=a();for(;e.length&&n-e[0]>t;)e.shift()}function u(e,t){let n=e.get(t)||[];return n.push(a()),e.set(t,n),n}function f(e,t){let n=(e.headers.get("cookie")||"").match(RegExp("(?:^|; )"+t+"=([^;]+)"));return n?decodeURIComponent(n[1]):null}function d(e){let t=(0,i.iE)();if(!function(e){let t=(0,i.iE)();if(!t.invites.length)return!0;let n=e.headers.get("x-invite-code")||"",r=f(e,"invite")||"",o=n||r;return!!o&&t.invites.includes(o)}(e))return{ok:!1,res:r.NextResponse.json({code:"invite_required",message:"Invite code required"},{status:403})};let n=(e.headers.get("x-forwarded-for")||"").split(",")[0].trim()||"0.0.0.0",d=f(e,"sid")||"anon",c=u(o,n),p=u(s,d);return(l(c,6e4),l(p,6e4),function(e=6e4,t=5e3){let n=a();for(let[t,r]of o){for(;r.length&&n-r[0]>e;)r.shift();0===r.length&&o.delete(t)}for(let[t,r]of s){for(;r.length&&n-r[0]>e;)r.shift();0===r.length&&s.delete(t)}if(o.size>t){for(let e of o.keys())if(o.delete(e),o.size<=t)break}if(s.size>t){for(let e of s.keys())if(s.delete(e),s.size<=t)break}}(),c.length>t.rate.ipPerMin||p.length>t.rate.sessionPerMin)?{ok:!1,res:r.NextResponse.json({code:"rate_limited",message:"Too many requests"},{status:429})}:{ok:!0}}},45647:(e,t,n)=>{n.d(t,{CT:()=>l,Gg:()=>a,ed:()=>s});var r=n(9576);let i=new Map;function o(e=36e5){let t=Date.now();for(let[n,r]of i)t-r.createdAt>e&&i.delete(n)}function s(e,t,n,s){o();let a=(0,r.Z)(),l={id:a,version:u(e,t),createdAt:Date.now(),original:e,tailored:t,jdText:n,keywordStats:s};return i.set(a,l),l}function a(e){o();let t=i.get(e);return t?Date.now()-t.createdAt>36e5?(i.delete(e),null):t:null}function l(e,t){let n=i.get(e);if(!n)return null;let r={...n,...t};return(t.original||t.tailored)&&(r.version=u(r.original,r.tailored)),i.set(e,r),r}function u(e,t){return btoa(JSON.stringify({original:e,tailored:t})).slice(0,16)}},9576:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(6113),i=n.n(r);let o={randomUUID:i().randomUUID},s=new Uint8Array(256),a=s.length,l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));let u=function(e,t,n){if(o.randomUUID&&!t&&!e)return o.randomUUID();let r=(e=e||{}).random||(e.rng||function(){return a>s.length-16&&(i().randomFillSync(s),a=0),s.slice(a,a+=16)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]}(r)}}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[948,972],()=>n(87574));module.exports=r})();