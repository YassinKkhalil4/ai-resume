"use strict";(()=>{var e={};e.id=607,e.ids=[607],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},52616:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>j,requestAsyncStorage:()=>_,routeModule:()=>k,serverHooks:()=>b,staticGenerationAsyncStorage:()=>R});var s={};r.r(s),r.d(s,{POST:()=>y,dynamic:()=>f,maxDuration:()=>x,runtime:()=>h});var n=r(49303),o=r(88716),i=r(60670),a=r(87070),l=r(48179),c=r(69836),u=r(21614),p=r(45647),m=r(32064),d=r(74068),g=r(57033);let h="nodejs",f="force-dynamic",x=30;async function y(e){let t;console.log("Tailor API called:",{method:e.method,url:e.url,timestamp:new Date().toISOString()});let r=null,s="",n="professional";try{let o=(0,m.d7)(e);if(!o.ok)return console.log("Guard check failed:",o.res),o.res;if((0,d.iE)().pauseTailor)return a.NextResponse.json({code:"tailor_paused",message:"Tailoring functionality is temporarily disabled"},{status:503});console.log("Guard check passed");let i=(0,g.db)({route:"tailor"});if(console.log("Trace started"),!(e.headers.get("content-type")||"").includes("multipart/form-data"))return a.NextResponse.json({code:"invalid_content_type",message:"Request must be multipart/form-data"},{status:415});let h=await e.formData();if(t=h.get("session_id")?.toString(),r=h.get("resume_file"),s=h.get("jd_text")?.toString()||"",n=h.get("tone")?.toString()||"professional",console.log("Processing request:",{hasResumeFile:!!r,jdTextLength:s.length,tone:n}),!r)return a.NextResponse.json({code:"missing_resume",message:"Missing resume input"},{status:400});if(!s)return a.NextResponse.json({code:"missing_jd",message:"Missing jd_text"},{status:400});let f=await (0,l.H)(r),x=f.text,y=f.ext;if("pdf"===y&&(!x||x.trim().length<50))return a.NextResponse.json({code:"scanned_pdf",message:"Your PDF appears to be image-only (scanned). Please upload a DOCX or a text-based PDF."},{status:400});console.log("Parsing resume...");let k=(0,l.r)(x);console.log("Resume parsed successfully:",{hasSummary:!!k.summary,skillsCount:k.skills?.length||0,experienceCount:k.experience?.length||0,educationCount:k.education?.length||0,certificationsCount:k.certifications?.length||0});let _=function(e){let t={isValid:!0,hasExperience:!1,hasSkills:!1,hasSummary:!1,experienceCount:0,skillsCount:0,summaryLength:0,errors:[],warnings:[],suggestions:[]};return e.experience&&e.experience.length>0?(t.hasExperience=!0,t.experienceCount=e.experience.length,e.experience.some(e=>e.bullets&&e.bullets.length>0)||(t.warnings.push("Experience found but no bullet points detected"),t.suggestions.push("Consider adding bullet points to your experience entries"))):(t.errors.push("No work experience detected"),t.suggestions.push("Paste your work history or pick lines to mark as experience")),e.skills&&e.skills.length>0?(t.hasSkills=!0,t.skillsCount=e.skills.length):(t.warnings.push("No skills section detected"),t.suggestions.push("Consider adding a skills section to your resume")),e.summary&&e.summary.trim().length>0?(t.hasSummary=!0,t.summaryLength=e.summary.trim().length,e.summary.trim().length<50&&(t.warnings.push("Summary is very short"),t.suggestions.push("Consider expanding your professional summary"))):(t.warnings.push("No summary detected"),t.suggestions.push("Consider adding a professional summary")),t.errors.length>0&&(t.isValid=!1),t}(k);if(console.log("Parsing validation:",_),!_.hasExperience||0===_.experienceCount)return a.NextResponse.json({code:"missing_experience",message:"No work experience detected in your resume",validation:_,original_sections_json:k,suggestions:["Paste your work history manually","Try uploading a different resume format","Check if your resume has experience section headings"]},{status:422});console.log("Tailoring resume...");let{tailored:R,tokens:b}=await (0,c.yC)(k,s,n);console.log("Resume tailored successfully:",{hasSummary:!!R.summary,skillsCount:R.skills_section?.length||0,experienceCount:R.experience?.length||0}),console.log("Running ATS check...");let w=(0,u.F)(k,s);console.log("ATS check completed:",{coverage:w.coverage,matchedKeywords:w.matched?.length||0,missingKeywords:w.missing?.length||0}),console.log("Creating session...");let j=(0,p.ed)(k,R,s,w);return console.log("Session created:",j.id),(0,g.Jf)({req_id:i.id,route:"tailor",timing:Date.now()-i.startTime,final_status:"success",additional_metrics:{resume_length:x.length,jd_length:s.length,tone:n,tokens_used:b,ats_coverage:w.coverage,original_experience_count:k.experience?.length||0,tailored_experience_count:R.experience?.length||0,validation_errors:_.errors.length,validation_warnings:_.warnings.length}}),i.end(!0,{session_id:j.id,tokens:b,ats_coverage:w.coverage}),a.NextResponse.json({session_id:j.id,version:j.version,original_sections_json:k,preview_sections_json:R,keyword_stats:w,tokens_used:b,message:"Resume tailored successfully",validation:_,parsing_details:{original_sections_found:{summary:!!k.summary,skills:(k.skills?.length||0)>0,experience:(k.experience?.length||0)>0,education:(k.education?.length||0)>0,certifications:(k.certifications?.length||0)>0},tailored_sections_generated:{summary:!!R.summary,skills:(R.skills_section?.length||0)>0,experience:(R.experience?.length||0)>0}}})}catch(i){console.error("Tailor API error:",i),console.error("Error stack:",i instanceof Error?i.stack:"No stack trace");let e={route:"tailor",session_id:t||"unknown",hasResumeFile:!!r,jdLength:s.length,tone:n||"unknown",errorMessage:i instanceof Error?i.message:String(i),errorStack:i instanceof Error?i.stack:void 0};(0,g.H)(i,e);let o=function(e,t){switch(function(e){let t=e.message.toLowerCase();return t.includes("json")||t.includes("parse")?"JSON_PARSE_ERROR":t.includes("schema")||t.includes("validation")?"SCHEMA_VALIDATION_ERROR":t.includes("empty")||t.includes("no content")?"EMPTY_RESPONSE_ERROR":t.includes("timeout")||t.includes("timed out")?"TIMEOUT_ERROR":t.includes("network")||t.includes("connection")?"NETWORK_ERROR":t.includes("rate limit")||t.includes("too many requests")?"RATE_LIMIT_ERROR":"UNKNOWN_ERROR"}(e)){case"JSON_PARSE_ERROR":return"The AI response was malformed. Please try again.";case"SCHEMA_VALIDATION_ERROR":return"The AI response format was unexpected. Please try again.";case"EMPTY_RESPONSE_ERROR":return"The AI service returned an empty response. Please try again.";case"TIMEOUT_ERROR":return"The request timed out. Please try again.";case"NETWORK_ERROR":return"Network error occurred. Please check your connection and try again.";case"RATE_LIMIT_ERROR":return"Too many requests. Please wait a moment and try again.";default:return"An unexpected error occurred. Please try again."}}(i,0);try{return a.NextResponse.json({code:"server_error",message:o,details:void 0,timestamp:new Date().toISOString(),error_type:i instanceof Error?i.constructor.name:"UnknownError"},{status:500})}catch(e){return console.error("Failed to create JSON response:",e),a.NextResponse.json({code:"server_error",message:"An unexpected error occurred"},{status:500})}}}let k=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/tailor/route",pathname:"/api/tailor",filename:"route",bundlePath:"app/api/tailor/route"},resolvedPagePath:"/Users/yassinkhalil/Downloads/ai-resume-tailor_v2_full/app/api/tailor/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:R,serverHooks:b}=k,w="/api/tailor/route";function j(){return(0,i.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:R})}},48179:(e,t,r)=>{r.d(t,{H:()=>n,r:()=>o});var s=r(47699);async function n(e){let t=Buffer.from(await e.arrayBuffer()),n=(e instanceof File?e.name.split(".").pop()?.toLowerCase():"txt")||"txt";if("pdf"===n)try{let e=await r.e(585).then(r.bind(r,17585)),s=await e.getDocument({data:t}).promise,o="";for(let e=1;e<=s.numPages;e++){let t=await s.getPage(e),r=await t.getTextContent();o+=r.items.map(e=>e.str).join(" ")+"\n"}return{text:o,ext:n}}catch(e){return console.error("PDF parsing failed:",e),{text:t.toString("utf8"),ext:"txt"}}else if("docx"===n)return{text:(await s.extractRawText({buffer:t})).value,ext:n};else return{text:t.toString("utf8"),ext:"txt"}}function o(e){var t,r;let s=(e||"").replace("\r","").split("\n").map(e=>e.trim()).filter(Boolean).join("\n"),n=function(e){let t={},r=e.split("\n"),s="",n=[];for(let e of r){let r=e.trim();(function(e){let t=i(e);return[/^(experience|work experience|professional experience|employment|work history|career history|professional background)$/,/^(work|employment|career|professional)$/,/^(skills|technical skills|core competencies|key skills|competencies|tech stack|technologies|technical expertise)$/,/^(core skills|key competencies|technical competencies|professional skills)$/,/^(programming languages|software skills|tools|software)$/,/^(summary|profile|objective|about|personal statement|professional summary)$/,/^(overview|introduction|bio|biography)$/,/^(education|academic background|academic qualifications|academic credentials)$/,/^(academic|qualifications|credentials|degrees)$/,/^(certifications|certificates|certs|professional certifications)$/,/^(licenses|licences|credentials|professional credentials)$/,/^(projects|project experience|project portfolio|key projects)$/,/^(portfolio|project work|project history)$/,/^(achievements|accomplishments|awards|honors|honours)$/,/^(recognition|awards and recognition|professional achievements)$/,/^(publications|research|volunteer|volunteer work|community service)$/,/^(languages|language skills|interests|hobbies|additional information)$/].some(e=>e.test(t))})(r)?(s&&(t[s.toLowerCase()]=n.join("\n")),s=r,n=[]):n.push(e)}return s&&(t[s.toLowerCase()]=n.join("\n")),t}(s);0!==Object.keys(n).length&&(t=n,["experience","skills","summary","education"].some(e=>t[e]&&t[e].trim().length>20))||(console.log("Primary parsing failed, attempting fallback segmentation"),n=function(e){console.log("Attempting fallback segmentation");let t=e.split("\n").map(e=>e.trim()).filter(Boolean),r={},s={experience:{indicators:["experience","work","employment","career","professional"],datePattern:/\b(19|20)\d{2}\b/,bulletPattern:/^[•\-\*]\s+/,companyPattern:/^[A-Z][^•\-\*]*[A-Z]/},skills:{indicators:["skills","competencies","technologies","tools","software"],listPattern:/^[A-Za-z][^•\-\*]*[,;]/,shortLinePattern:/^[A-Za-z\s]{2,30}$/},summary:{indicators:["summary","profile","objective","about"],longTextPattern:/^[A-Za-z][^•\-\*]{50,}/,firstSection:!0}},n="",o=[],a={};for(let e=0;e<t.length;e++){let l=t[e],c=i(l);for(let[t,r]of Object.entries(s)){let s=0;r.indicators.some(e=>c.includes(e))&&(s+=3),"experience"===t?(r.datePattern.test(l)&&(s+=2),r.bulletPattern.test(l)&&(s+=1),r.companyPattern.test(l)&&(s+=2)):"skills"===t?(r.listPattern.test(l)&&(s+=2),r.shortLinePattern.test(l)&&(s+=1)):"summary"===t&&(r.longTextPattern.test(l)&&(s+=2),r.firstSection&&e<5&&(s+=1)),a[t]=(a[t]||0)+s}let u=Object.entries(a).reduce((e,t)=>a[e[0]]>a[t[0]]?e:t);u[1]>2&&u[0]!==n?(n&&(r[n]=o.join("\n")),n=u[0],o=[l],a={}):o.push(l)}return(n&&(r[n]=o.join("\n")),0===Object.keys(r).length)?function(e){console.log("Attempting content-based segmentation");let t=e.split("\n").map(e=>e.trim()).filter(Boolean),r={},s="summary",n=[];for(let e of t)(function(e){return[/\b(19|20)\d{2}\b/,/\b(at|@|\-|\|)\b/,/\b(engineer|manager|developer|analyst|consultant|director|lead|senior|junior)\b/i,/\b(company|corp|inc|llc|ltd)\b/i].some(t=>t.test(e))})(e)?(n.length>0&&(r[s]=n.join("\n")),s="experience",n=[e]):function(e){return[/^[A-Za-z][^•\-\*]*[,;]/,/^[A-Za-z\s]{2,30}$/,/\b(java|python|javascript|react|angular|vue|node|sql|aws|azure|docker|kubernetes)\b/i].some(t=>t.test(e))}(e)?(n.length>0&&(r[s]=n.join("\n")),s="skills",n=[e]):n.push(e);return n.length>0&&(r[s]=n.join("\n")),r}(e):r}(s));let o=function(e){let t=[],r=e.split("\n").filter(Boolean),s=null;for(let e of r){let r=e.trim();(function(e){return[/^[^•\-\*].*(at|@|\-|\|).*[0-9]{4}/i,/^[A-Z][^•\-\*]*[A-Z].*[0-9]{4}/,/^[^•\-\*].*\b(19|20)\d{2}\b/,/^[A-Z][^•\-\*]*\b(engineer|manager|developer|analyst|consultant|director|lead|senior|junior)\b/i].some(t=>t.test(e))})(r)?(s&&t.push(s),s=function(e){let t=e.split(/at|@|\-|\||\b(19|20)\d{2}\b/).map(e=>e.trim()).filter(Boolean);if(t.length>=2)return{role:t[0],company:t[1]||"Unknown",bullets:[]};let r=e.match(/\b(engineer|manager|developer|analyst|consultant|director|lead|senior|junior)\b/i),s=e.match(/\b[A-Z][^•\-\*]*[A-Z]\b/);return{role:r?r[0]:e,company:s?s[0]:"Unknown",bullets:[]}}(r)):s&&(/^[•\-\*]/.test(r)||/^[0-9]+\./.test(r))&&s.bullets.push(r)}return s&&t.push(s),t}(n.experience||n.work||n["work experience"]||n["professional experience"]||""),a=(r=n.skills||n["core competencies"]||n["technical skills"]||n["key skills"]||n["tech stack"]||n.competencies||"").trim()?r.split(/[•,;\n|]/).map(e=>e.trim()).filter(Boolean).filter(e=>e.length>2&&e.length<50).slice(0,60):[];return{summary:(n.summary||n.profile||n.objective||n.about||"").split("\n").slice(0,3).join(" "),skills:a,experience:o,education:(n.education||n["academic background"]||"").split("\n").filter(Boolean),certifications:(n.certifications||n.certificates||n.certs||"").split("\n").filter(Boolean)}}function i(e){return e.replace(/[:\-\*\.\s]+$/,"").replace(/^[:\-\*\.\s]+/,"").toLowerCase().replace(/\s+/g," ").trim()}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,969,699,844,542],()=>r(52616));module.exports=s})();