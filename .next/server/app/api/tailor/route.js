"use strict";(()=>{var e={};e.id=607,e.ids=[607],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},7865:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>O,patchFetch:()=>v,requestAsyncStorage:()=>E,routeModule:()=>y,serverHooks:()=>T,staticGenerationAsyncStorage:()=>k});var t={};s.r(t),s.d(t,{POST:()=>f,dynamic:()=>R,maxDuration:()=>x,runtime:()=>h});var o=s(49303),n=s(88716),i=s(60670),a=s(87070),l=s(48179),u=s(85892),c=s(21614),d=s(45647),g=s(32064),p=s(74068),m=s(57033),_=s(77462);let h="nodejs",R="force-dynamic",x=30;async function f(e){let r;console.log("Tailor API called:",{method:e.method,url:e.url,timestamp:new Date().toISOString()});let s=null,t="",o="professional";try{let n=(0,g.d7)(e);if(!n.ok)return console.log("Guard check failed:",n.res),n.res;if((0,p.iE)().pauseTailor)return a.NextResponse.json({code:"tailor_paused",message:"Tailoring functionality is temporarily disabled"},{status:503});console.log("Guard check passed");let i=(0,m.db)({route:"tailor"});if(console.log("Trace started"),!(e.headers.get("content-type")||"").includes("multipart/form-data"))return a.NextResponse.json({code:"invalid_content_type",message:"Request must be multipart/form-data"},{status:415});let h=await e.formData();if(r=h.get("session_id")?.toString(),s=h.get("resume_file"),t=h.get("jd_text")?.toString()||"",o=h.get("tone")?.toString()||"professional",console.log("Processing request:",{hasResumeFile:!!s,jdTextLength:t.length,tone:o}),!s)return a.NextResponse.json({code:"missing_resume",message:"Missing resume input"},{status:400});if(!t)return a.NextResponse.json({code:"missing_jd",message:"Missing jd_text"},{status:400});let R=await (0,l.H)(s),x=R.text,f=R.ext;if("pdf"===f&&(!x||x.trim().length<50))return a.NextResponse.json({code:"scanned_pdf",message:"Your PDF appears to be image-only (scanned). Please upload a DOCX or a text-based PDF."},{status:400});console.log("Parsing resume...");let y=(0,l.r)(x);console.log("Resume parsed successfully:",{hasSummary:!!y.summary,skillsCount:y.skills?.length||0,experienceCount:y.experience?.length||0,educationCount:y.education?.length||0,certificationsCount:y.certifications?.length||0});let E=(0,_.CQ)(y);if(console.log("Parsing validation:",E),(0,_.VV)(E))return a.NextResponse.json({code:"missing_experience",message:"No work experience detected in your resume",validation:E,original_sections_json:y,suggestions:["Paste your work history manually","Try uploading a different resume format","Check if your resume has experience section headings"]},{status:422});console.log("Tailoring resume...");let{tailored:k,tokens:T}=await (0,u.yC)(y,t,o);console.log("Resume tailored successfully:",{hasSummary:!!k.summary,skillsCount:k.skills_section?.length||0,experienceCount:k.experience?.length||0}),console.log("Running ATS check...");let O=(0,c.F)(y,t);console.log("ATS check completed:",{coverage:O.coverage,matchedKeywords:O.matched?.length||0,missingKeywords:O.missing?.length||0}),console.log("Creating session...");let v=(0,d.ed)(y,k,t,O);return console.log("Session created:",v.id),(0,m.Jf)({req_id:i.id,route:"tailor",timing:Date.now()-i.startTime,final_status:"success",additional_metrics:{resume_length:x.length,jd_length:t.length,tone:o,tokens_used:T,ats_coverage:O.coverage,original_experience_count:y.experience?.length||0,tailored_experience_count:k.experience?.length||0,validation_errors:E.errors.length,validation_warnings:E.warnings.length}}),i.end(!0,{session_id:v.id,tokens:T,ats_coverage:O.coverage}),a.NextResponse.json({session_id:v.id,version:v.version,original_sections_json:y,preview_sections_json:k,keyword_stats:O,tokens_used:T,message:"Resume tailored successfully",validation:E,parsing_details:{original_sections_found:{summary:!!y.summary,skills:(y.skills?.length||0)>0,experience:(y.experience?.length||0)>0,education:(y.education?.length||0)>0,certifications:(y.certifications?.length||0)>0},tailored_sections_generated:{summary:!!k.summary,skills:(k.skills_section?.length||0)>0,experience:(k.experience?.length||0)>0}}})}catch(i){console.error("Tailor API error:",i),console.error("Error stack:",i instanceof Error?i.stack:"No stack trace");let e={route:"tailor",session_id:r||"unknown",hasResumeFile:!!s,jdLength:t.length,tone:o||"unknown",errorMessage:i instanceof Error?i.message:String(i),errorStack:i instanceof Error?i.stack:void 0};(0,m.H)(i,e);let n=function(e,r){switch(function(e){let r=e.message.toLowerCase();return r.includes("json")||r.includes("parse")?"JSON_PARSE_ERROR":r.includes("schema")||r.includes("validation")?"SCHEMA_VALIDATION_ERROR":r.includes("empty")||r.includes("no content")?"EMPTY_RESPONSE_ERROR":r.includes("timeout")||r.includes("timed out")?"TIMEOUT_ERROR":r.includes("network")||r.includes("connection")?"NETWORK_ERROR":r.includes("rate limit")||r.includes("too many requests")?"RATE_LIMIT_ERROR":"UNKNOWN_ERROR"}(e)){case"JSON_PARSE_ERROR":return"The AI response was malformed. Please try again.";case"SCHEMA_VALIDATION_ERROR":return"The AI response format was unexpected. Please try again.";case"EMPTY_RESPONSE_ERROR":return"The AI service returned an empty response. Please try again.";case"TIMEOUT_ERROR":return"The request timed out. Please try again.";case"NETWORK_ERROR":return"Network error occurred. Please check your connection and try again.";case"RATE_LIMIT_ERROR":return"Too many requests. Please wait a moment and try again.";default:return"An unexpected error occurred. Please try again."}}(i,0);try{return a.NextResponse.json({code:"server_error",message:n,details:void 0,timestamp:new Date().toISOString(),error_type:i instanceof Error?i.constructor.name:"UnknownError"},{status:500})}catch(e){return console.error("Failed to create JSON response:",e),a.NextResponse.json({code:"server_error",message:"An unexpected error occurred"},{status:500})}}}let y=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/tailor/route",pathname:"/api/tailor",filename:"route",bundlePath:"app/api/tailor/route"},resolvedPagePath:"/Users/yassinkhalil/Downloads/ai-resume-tailor_v2_full/app/api/tailor/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:E,staticGenerationAsyncStorage:k,serverHooks:T}=y,O="/api/tailor/route";function v(){return(0,i.patchFetch)({serverHooks:T,staticGenerationAsyncStorage:k})}}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[948,972,214,969,882,699,440,175],()=>s(7865));module.exports=t})();